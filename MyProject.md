# Сессионное задание. Линейная алгебра -`Александра Бужор`

---

# Задание 1. Ассоциативность умножения матриц

## Шаг 1: Формирование матрицы признаков X

Берём **первые 3 квартиры** и **3 признака**: Комнаты, Площадь, Этаж.

**Матрица X** (3 квартиры × 3 признака):

```
       Комнаты  Площадь  Этаж
X = [     3       51      3     ]  ← квартира 1
    [     1       30      1     ]  ← квартира 2
    [     2       45      2     ]  ← квартира 3
```

**Размерность X: 3×3** (3 строки, 3 столбца)

---

## Шаг 2: Формирование вектора цен Y

Берём цены **первых 3 квартир**:

```
       Цена
Y = [  2200  ]  ← цена квартиры 1
    [  1600  ]  ← цена квартиры 2
    [  1900  ]  ← цена квартиры 3
```

**Размерность Y: 3×1** (3 строки, 1 столбец)

---

## Шаг 3: Транспонирование матрицы X

**Транспонирование** означает, что строки становятся столбцами, а столбцы — строками.

**X^T** (3 признака × 3 квартиры):

```
X^T = [  3    1    2  ]  ← признак "Комнаты"
      [ 51   30   45  ]  ← признак "Площадь"
      [  3    1    2  ]  ← признак "Этаж"
```

**Размерность X^T: 3×3**

---

# Задача 1: Вычислить X^T(XY)

Формула из задания: **(X^T X)^(-1) X^T Y**

Нам нужно вычислить: **X^T(XY)**

Это выражение можно вычислить двумя способами благодаря ассоциативности:
1. **Способ 1 (скобки справа)**: сначала u = XY, затем X^T u
2. **Способ 2 (скобки слева)**: сначала M = X^T X, затем M Y

Но по условию написано **X^T(XY)**, значит нужно вычислять именно в таком порядке.

Однако проверим размерности для **XY**:
- X: 3×3
- Y: 3×1
- Результат XY: 3×1 

Отлично! Размерности совместимы.

---

## Вычисление XY (Способ 1)

X — матрица 3×3
Y — вектор 3×1
Результат — вектор 3×1

### Элемент 1: первая строка X × вектор Y

```
X строка 1: [3, 51, 3]
Y:          [2200, 1600, 1900]

Элемент 1 = 3×2200 + 51×1600 + 3×1900
          = 6600 + 81600 + 5700
          = 93900
```

---

### Элемент 2: вторая строка X × вектор Y

```
X строка 2: [1, 30, 1]
Y:          [2200, 1600, 1900]

Элемент 2 = 1×2200 + 30×1600 + 1×1900
          = 2200 + 48000 + 1900
          = 52100
```

---

### Элемент 3: третья строка X × вектор Y

```
X строка 3: [2, 45, 2]
Y:          [2200, 1600, 1900]

Элемент 3 = 2×2200 + 45×1600 + 2×1900
          = 4400 + 72000 + 3800
          = 80200
```

---

### Итоговый вектор XY:

```
XY = [ 93900 ]
     [ 52100 ]
     [ 80200 ]
```

**Размерность: 3×1**

---

## Вычисление X^T(XY)

Теперь умножаем X^T на полученный вектор XY.

**X^T**: 3×3
**XY**: 3×1
**Результат**: 3×1

### Элемент 1: первая строка X^T × вектор (XY)

```
X^T строка 1: [3, 1, 2]
XY:           [93900, 52100, 80200]

Элемент 1 = 3×93900 + 1×52100 + 2×80200
          = 281700 + 52100 + 160400
          = 494200
```

---

### Элемент 2: вторая строка X^T × вектор (XY)

```
X^T строка 2: [51, 30, 45]
XY:           [93900, 52100, 80200]

Элемент 2 = 51×93900 + 30×52100 + 45×80200
          = 4788900 + 1563000 + 3609000
          = 9960900
```

---

### Элемент 3: третья строка X^T × вектор (XY)

```
X^T строка 3: [3, 1, 2]
XY:           [93900, 52100, 80200]

Элемент 3 = 3×93900 + 1×52100 + 2×80200
          = 281700 + 52100 + 160400
          = 494200
```

---

### Итоговый результат X^T(XY):

```
X^T(XY) = [ 494200  ]
          [ 9960900 ]
          [ 494200  ]
```

**Размерность: 3×1**

---

# Способ 2: Вычислить (X^T X)Y

Теперь проверим ассоциативность, вычислив тот же результат другим способом.

## Вычисление X^T X

**X^T**: 3×3
**X**: 3×3
**Результат**: 3×3

Распишу **каждый элемент** подробно:

---

### Элемент (1,1): первая строка X^T × первый столбец X

```
X^T строка 1: [3, 1, 2]
X столбец 1:  [3, 1, 2] (это "Комнаты")

(1,1) = 3×3 + 1×1 + 2×2
      = 9 + 1 + 4
      = 14
```

---

### Элемент (1,2): первая строка X^T × второй столбец X

```
X^T строка 1: [3, 1, 2]
X столбец 2:  [51, 30, 45] (это "Площадь")

(1,2) = 3×51 + 1×30 + 2×45
      = 153 + 30 + 90
      = 273
```

---

### Элемент (1,3): первая строка X^T × третий столбец X

```
X^T строка 1: [3, 1, 2]
X столбец 3:  [3, 1, 2] (это "Этаж")

(1,3) = 3×3 + 1×1 + 2×2
      = 9 + 1 + 4
      = 14
```

---

### Элемент (2,1): вторая строка X^T × первый столбец X

```
X^T строка 2: [51, 30, 45]
X столбец 1:  [3, 1, 2]

(2,1) = 51×3 + 30×1 + 45×2
      = 153 + 30 + 90
      = 273
```

Заметь: (2,1) = (1,2) = 273. Матрица **симметричная**! 

---

### Элемент (2,2): вторая строка X^T × второй столбец X

```
X^T строка 2: [51, 30, 45]
X столбец 2:  [51, 30, 45]

(2,2) = 51×51 + 30×30 + 45×45
      = 2601 + 900 + 2025
      = 5526
```

---

### Элемент (2,3): вторая строка X^T × третий столбец X

```
X^T строка 2: [51, 30, 45]
X столбец 3:  [3, 1, 2]

(2,3) = 51×3 + 30×1 + 45×2
      = 153 + 30 + 90
      = 273
```

---

### Элемент (3,1): третья строка X^T × первый столбец X

```
X^T строка 3: [3, 1, 2]
X столбец 1:  [3, 1, 2]

(3,1) = 3×3 + 1×1 + 2×2
      = 9 + 1 + 4
      = 14
```

---

### Элемент (3,2): третья строка X^T × второй столбец X

```
X^T строка 3: [3, 1, 2]
X столбец 2:  [51, 30, 45]

(3,2) = 3×51 + 1×30 + 2×45
      = 153 + 30 + 90
      = 273
```

---

### Элемент (3,3): третья строка X^T × третий столбец X

```
X^T строка 3: [3, 1, 2]
X столбец 3:  [3, 1, 2]

(3,3) = 3×3 + 1×1 + 2×2
      = 9 + 1 + 4
      = 14
```

---

### Итоговая матрица X^T X:

```
X^T X = [  14   273   14  ]
        [ 273  5526  273  ]
        [  14   273   14  ]
```

**Размерность: 3×3**

Матрица **симметричная** 

---

## Вычисление (X^T X) × Y

Теперь умножим полученную матрицу на вектор Y.

**X^T X**: 3×3
**Y**: 3×1
**Результат**: 3×1

---

### Элемент 1: первая строка (X^T X) × вектор Y

```
(X^T X) строка 1: [14, 273, 14]
Y:                [2200, 1600, 1900]

Элемент 1 = 14×2200 + 273×1600 + 14×1900
          = 30800 + 436800 + 26600
          = 494200
```

---

### Элемент 2: вторая строка (X^T X) × вектор Y

```
(X^T X) строка 2: [273, 5526, 273]
Y:                [2200, 1600, 1900]

Элемент 2 = 273×2200 + 5526×1600 + 273×1900
          = 600600 + 8841600 + 518700
          = 9960900
```

---

### Элемент 3: третья строка (X^T X) × вектор Y

```
(X^T X) строка 3: [14, 273, 14]
Y:                [2200, 1600, 1900]

Элемент 3 = 14×2200 + 273×1600 + 14×1900
          = 30800 + 436800 + 26600
          = 494200
```

---

### Итоговый результат (X^T X)Y:

```
(X^T X)Y = [ 494200  ]
           [ 9960900 ]
           [ 494200  ]
```

**Размерность: 3×1**

---

# Проверка ассоциативности:

## Способ 1: X^T(XY) = ?

```
X^T(XY) = [ 494200  ]
          [ 9960900 ]
          [ 494200  ]
```

## Способ 2: (X^T X)Y = ?

```
(X^T X)Y = [ 494200  ]
           [ 9960900 ]
           [ 494200  ]
```

### **Результаты СОВПАДАЮТ!**

Это подтверждает **ассоциативность умножения матриц**: X^T(XY) = (X^T X)Y

---

# Подсчёт количества операций

## Способ 1 (скобки справа): сначала u = XY, затем X^T u

### Шаг 1: XY
- Размерности: (3×3) × (3×1) = (3×1)
- **Умножений**: 3 × 3 × 1 = **9**
- **Сложений**: 3 × 1 × (3-1) = 3 × 1 × 2 = **6**

### Шаг 2: X^T(XY)
- Размерности: (3×3) × (3×1) = (3×1)
- **Умножений**: 3 × 3 × 1 = **9**
- **Сложений**: 3 × 1 × (3-1) = 3 × 1 × 2 = **6**

**Итого (Способ 1):**
- Умножений: 9 + 9 = **18**
- Сложений: 6 + 6 = **12**
- **Всего операций: 30**

---

## Способ 2 (скобки слева): сначала M = X^T X, затем MY

### Шаг 1: X^T X
- Размерности: (3×3) × (3×3) = (3×3)
- **Умножений**: 3 × 3 × 3 = **27**
- **Сложений**: 3 × 3 × (3-1) = 3 × 3 × 2 = **18**

### Шаг 2: (X^T X)Y
- Размерности: (3×3) × (3×1) = (3×1)
- **Умножений**: 3 × 3 × 1 = **9**
- **Сложений**: 3 × 1 × (3-1) = 3 × 1 × 2 = **6**

**Итого (Способ 2):**
- Умножений: 27 + 9 = **36**
- Сложений: 18 + 6 = **24**
- **Всего операций: 60**

---

# Сравнение способов:

| Способ | Умножений | Сложений | Всего операций |
|--------|-----------|----------|----------------|
| **Способ 1**: X^T(XY) | 18 | 12 | **30**  |
| **Способ 2**: (X^T X)Y | 36 | 24 | **60** |

**Вывод:** Способ 1 в **2 раза эффективнее**! 

---

# Выводы по Заданию 1:

1. **Ассоциативность доказана**: X^T(XY) = (X^T X)Y = [494200, 9960900, 494200]^T

2. **Порядок вычислений критичен для эффективности**: 
   - Способ 1 требует 30 операций
   - Способ 2 требует 60 операций

3. **Почему это важно в анализе данных?**
   - При работе с миллионами квартир правильный порядок сокращает время с часов до минут
   - В машинном обучении выбор эффективного алгоритма — ключ к успеху

4. **Практический смысл**:
   - X^T X — матрица взаимосвязей между признаками (комнатами, площадью, этажом)
   - Диагональные элементы (14, 5526, 14) показывают "силу" каждого признака
   - Недиагональные элементы (273) показывают корреляции между признаками

---
Отлично! Продолжаем.

---

## Задание 2. Связь признаков с ценой

Здесь нам нужно понять, какие признаки **сильнее всего влияют** на цену квартиры. Для этого используем **корреляцию Пирсона**.

### Что такое корреляция?

Корреляция показывает, насколько два признака связаны линейно. Значения от -1 до +1:
- **+1** = идеальная положительная связь (один растёт → другой тоже растёт)
- **0** = нет линейной связи
- **-1** = идеальная отрицательная связь (один растёт → другой падает)

### Формула корреляции Пирсона:

r(x,y) = Σ[(xᵢ - x̄)(yᵢ - ȳ)] / √[Σ(xᵢ - x̄)² × Σ(yᵢ - ȳ)²]

где x̄ и ȳ — средние значения.

---

### Шаг 1: Составляем матрицу X и вектор Y

Используем ВСЕ признаки из таблицы:

**X** (матрица признаков 5×5):
```
Комнаты  Площадь  Этаж  Центр  Спальный1
   3       51      3     0        1
   1       30      1     0        1
   2       45      2     0        1
   3       55      1     0        1
   1       45      3     1        0
```

**Y** (вектор цен 5×1):
```
2200
1600
1900
2000
4500
```

---

### Шаг 2: Вычисляем средние значения

- **Комнаты**: (3+1+2+3+1)/5 = 10/5 = 2
- **Площадь**: (51+30+45+55+45)/5 = 226/5 = 45.2
- **Этаж**: (3+1+2+1+3)/5 = 10/5 = 2
- **Центр**: (0+0+0+0+1)/5 = 1/5 = 0.2
- **Спальный1**: (1+1+1+1+0)/5 = 4/5 = 0.8
- **Цена (Y)**: (2200+1600+1900+2000+4500)/5 = 12200/5 = 2440

---

### Шаг 3: Вычисляем корреляцию каждого признака с ценой

#### 1) Корреляция «Комнаты» с «Цена»:

Отклонения от среднего:
- Комнаты: (3-2)=1, (1-2)=-1, (2-2)=0, (3-2)=1, (1-2)=-1
- Цена: (2200-2440)=-240, (1600-2440)=-840, (1900-2440)=-540, (2000-2440)=-440, (4500-2440)=2060

Произведения отклонений:
- 1×(-240) = -240
- (-1)×(-840) = 840
- 0×(-540) = 0
- 1×(-440) = -440
- (-1)×2060 = -2060

Сумма произведений: -240 + 840 + 0 - 440 - 2060 = **-1900**

Сумма квадратов отклонений:
- Комнаты: 1² + (-1)² + 0² + 1² + (-1)² = 1+1+0+1+1 = 4
- Цена: 240² + 840² + 540² + 440² + 2060² = 57600 + 705600 + 291600 + 193600 + 4243600 = 5492000

**r(Комнаты, Цена)** = -1900 / √(4 × 5492000) = -1900 / √21968000 = -1900 / 4687 ≈ **-0.405**

---

#### 2) Корреляция «Площадь» с «Цена»:

Отклонения от среднего:
- Площадь: (51-45.2)=5.8, (30-45.2)=-15.2, (45-45.2)=-0.2, (55-45.2)=9.8, (45-45.2)=-0.2

Произведения отклонений:
- 5.8×(-240) = -1392
- (-15.2)×(-840) = 12768
- (-0.2)×(-540) = 108
- 9.8×(-440) = -4312
- (-0.2)×2060 = -412

Сумма: -1392 + 12768 + 108 - 4312 - 412 = **6760**

Сумма квадратов отклонений:
- Площадь: 5.8² + 15.2² + 0.2² + 9.8² + 0.2² = 33.64 + 231.04 + 0.04 + 96.04 + 0.04 = 360.8

**r(Площадь, Цена)** = 6760 / √(360.8 × 5492000) = 6760 / √1981513600 = 6760 / 44515 ≈ **+0.152**

---

#### 3) Корреляция «Этаж» с «Цена»:

Отклонения от среднего:
- Этаж: (3-2)=1, (1-2)=-1, (2-2)=0, (1-2)=-1, (3-2)=1

Произведения отклонений:
- 1×(-240) = -240
- (-1)×(-840) = 840
- 0×(-540) = 0
- (-1)×(-440) = 440
- 1×2060 = 2060

Сумма: -240 + 840 + 0 + 440 + 2060 = **3100**

Сумма квадратов отклонений (этаж):
- 1² + (-1)² + 0² + (-1)² + 1² = 4

**r(Этаж, Цена)** = 3100 / √(4 × 5492000) = 3100 / 4687 ≈ **+0.661**

---

#### 4) Корреляция «Центр» с «Цена»:

Отклонения от среднего:
- Центр: (0-0.2)=-0.2, (0-0.2)=-0.2, (0-0.2)=-0.2, (0-0.2)=-0.2, (1-0.2)=0.8

Произведения отклонений:
- (-0.2)×(-240) = 48
- (-0.2)×(-840) = 168
- (-0.2)×(-540) = 108
- (-0.2)×(-440) = 88
- 0.8×2060 = 1648

Сумма: 48 + 168 + 108 + 88 + 1648 = **2060**

Сумма квадратов отклонений (центр):
- 0.2² + 0.2² + 0.2² + 0.2² + 0.8² = 0.04×4 + 0.64 = 0.16 + 0.64 = 0.8

**r(Центр, Цена)** = 2060 / √(0.8 × 5492000) = 2060 / √4393600 = 2060 / 2096 ≈ **+0.983**

---

#### 5) Корреляция «Спальный1» с «Цена»:

Отклонения от среднего:
- Спальный1: (1-0.8)=0.2, (1-0.8)=0.2, (1-0.8)=0.2, (1-0.8)=0.2, (0-0.8)=-0.8

Произведения отклонений:
- 0.2×(-240) = -48
- 0.2×(-840) = -168
- 0.2×(-540) = -108
- 0.2×(-440) = -88
- (-0.8)×2060 = -1648

Сумма: -48 - 168 - 108 - 88 - 1648 = **-2060**

Сумма квадратов отклонений (спальный1): 0.8 (такая же как для центра)

**r(Спальный1, Цена)** = -2060 / √(0.8 × 5492000) = -2060 / 2096 ≈ **-0.983**

---

### Шаг 4: Сводная таблица корреляций

| Признак | Корреляция с ценой | Интерпретация |
|---------|-------------------|---------------|
| **Центр** | **+0.983** | Очень сильная положительная связь |
| **Спальный1** | **-0.983** | Очень сильная отрицательная связь |
| **Этаж** | +0.661 | Средняя положительная связь |
| **Площадь** | +0.152 | Слабая положительная связь |
| **Комнаты** | -0.405 | Слабая отрицательная связь |

---

### Выводы:

1. **Признак «Центр» имеет наибольшую связь с ценой** (r ≈ 0.98). Квартиры в центре намного дороже!

2. **«Спальный1» имеет сильную отрицательную корреляцию** (r ≈ -0.98). Это логично: если квартира НЕ в спальном районе 1, то она в центре (где дороже).

3. **Этаж** тоже важен (r ≈ 0.66) — более высокие этажи дороже.

4. **Площадь**, как ни странно, слабо коррелирует с ценой в этой выборке (r ≈ 0.15). Это может быть из-за маленького размера выборки (всего 5 квартир) или из-за того, что расположение важнее площади.

5. **Бинарные признаки** (Центр, Спальный1) показывают точечно-бисериальную корреляцию — она измеряет различие средних цен между группами.
6. **Практический вывод для модели**: 
- В регрессии нужно обязательно включить признак "Центр"
- Признаки "Комнаты" и "Площадь" могут быть менее важны

---
# Задание 3. Зависимость признаков

## Цель задания

Понять, есть ли **мультиколлинеарность** — ситуация, когда признаки сильно связаны друг с другом. Это плохо для модели, потому что:
- Модель становится нестабильной
- Сложно интерпретировать коэффициенты
- Признаки дублируют информацию

Для проверки построим **корреляционную матрицу** между признаками.

---

## Что такое корреляционная матрица?

Это квадратная матрица, где:
- **Строки** — признаки
- **Столбцы** — признаки  
- **Элемент (i,j)** — корреляция между признаком i и признаком j

**Свойства:**
- На **главной диагонали** всегда единицы (признак полностью коррелирует с самим собой)
- Матрица **симметричная**: r(x,y) = r(y,x)

---

## Шаг 1: Используем только числовые признаки

По заданию берём только: **Комнаты, Площадь, Этаж**

Напомню данные (все 5 квартир):

```
       Комнаты  Площадь  Этаж
   [      3       51      3     ]  ← квартира 1
   [      1       30      1     ]  ← квартира 2
   [      2       45      2     ]  ← квартира 3
   [      3       55      1     ]  ← квартира 4
   [      1       45      3     ]  ← квартира 5
```

---

## Шаг 2: Средние значения (уже вычислили)

```
x̄(Комнаты) = 2
x̄(Площадь) = 45.2
x̄(Этаж) = 2
```

---

## Шаг 3: Отклонения от среднего

### Комнаты:
```
Квартира 1: 3 - 2 = +1
Квартира 2: 1 - 2 = -1
Квартира 3: 2 - 2 = 0
Квартира 4: 3 - 2 = +1
Квартира 5: 1 - 2 = -1
```

### Площадь:
```
Квартира 1: 51 - 45.2 = +5.8
Квартира 2: 30 - 45.2 = -15.2
Квартира 3: 45 - 45.2 = -0.2
Квартира 4: 55 - 45.2 = +9.8
Квартира 5: 45 - 45.2 = -0.2
```

### Этаж:
```
Квартира 1: 3 - 2 = +1
Квартира 2: 1 - 2 = -1
Квартира 3: 2 - 2 = 0
Квартира 4: 1 - 2 = -1
Квартира 5: 3 - 2 = +1
```

---

## Шаг 4: Суммы квадратов отклонений (уже вычислили)

```
Σ(Комнаты - x̄)² = 4
Σ(Площадь - x̄)² = 360.8
Σ(Этаж - x̄)² = 4
```

---

# Корреляция 1: "Комнаты" × "Площадь"

## Шаг 4.1: Произведения отклонений

```
Квартира 1: (+1) × (+5.8) = +5.8
Квартира 2: (-1) × (-15.2) = +15.2
Квартира 3: (0) × (-0.2) = 0
Квартира 4: (+1) × (+9.8) = +9.8
Квартира 5: (-1) × (-0.2) = +0.2
```

### Сумма произведений:

```
Σ[(Комнаты - x̄)(Площадь - ȳ)] = 5.8 + 15.2 + 0 + 9.8 + 0.2
                                = 31.0
```

---

## Шаг 4.2: Вычисляем корреляцию

```
r(Комнаты, Площадь) = 31.0 / √(4 × 360.8)
                    = 31.0 / √1,443.2
                    = 31.0 / 37.99
                    ≈ +0.816
```

### **r(Комнаты, Площадь) ≈ +0.816**

**Интерпретация:** Сильная **положительная** связь! Больше комнат → больше площадь (логично!)

---

# Корреляция 2: "Комнаты" × "Этаж"

## Шаг 4.1: Произведения отклонений

```
Квартира 1: (+1) × (+1) = +1
Квартира 2: (-1) × (-1) = +1
Квартира 3: (0) × (0) = 0
Квартира 4: (+1) × (-1) = -1
Квартира 5: (-1) × (+1) = -1
```

### Сумма произведений:

```
Σ[(Комнаты - x̄)(Этаж - ȳ)] = 1 + 1 + 0 + (-1) + (-1)
                             = 0
```

---

## Шаг 4.2: Вычисляем корреляцию

```
r(Комнаты, Этаж) = 0 / √(4 × 4)
                 = 0 / √16
                 = 0 / 4
                 = 0
```

### **r(Комнаты, Этаж) = 0**

**Интерпретация:** **Нет линейной связи** между количеством комнат и этажом! Это хорошо — признаки независимы.

---

# Корреляция 3: "Площадь" × "Этаж"

## Шаг 4.1: Произведения отклонений

```
Квартира 1: (+5.8) × (+1) = +5.8
Квартира 2: (-15.2) × (-1) = +15.2
Квартира 3: (-0.2) × (0) = 0
Квартира 4: (+9.8) × (-1) = -9.8
Квартира 5: (-0.2) × (+1) = -0.2
```

### Сумма произведений:

```
Σ[(Площадь - x̄)(Этаж - ȳ)] = 5.8 + 15.2 + 0 + (-9.8) + (-0.2)
                             = 21.0 - 10.0
                             = 11.0
```

---

## Шаг 4.2: Вычисляем корреляцию

```
r(Площадь, Этаж) = 11.0 / √(360.8 × 4)
                 = 11.0 / √1,443.2
                 = 11.0 / 37.99
                 ≈ +0.290
```

### **r(Площадь, Этаж) ≈ +0.290**

**Интерпретация:** Слабая **положительная** связь. Больше площадь → немного выше этаж.

---

# Корреляционная матрица R

Теперь соберём все вычисленные корреляции в матрицу:

```
              Комнаты  Площадь  Этаж
Комнаты    [   1.000    0.816   0.000  ]
Площадь    [   0.816    1.000   0.290  ]
Этаж       [   0.000    0.290   1.000  ]
```

**Размерность: 3×3**

**Свойства матрицы:**
1. **Симметричная**: r(i,j) = r(j,i)
2. **Диагональ = 1**: каждый признак идеально коррелирует сам с собой
3. **Значения от -1 до +1**

---

## Шаг 5: Найти ранг матрицы R

**Ранг матрицы** — это максимальное число линейно независимых строк (или столбцов).

### Что такое линейная зависимость?

Строки (или столбцы) **линейно зависимы**, если одна из них может быть выражена через другие.

**Пример:**
Если бы признак "Этаж" всегда равнялся "2 × Комнаты", то строки были бы зависимы.

### Как определить ранг?

1. **Способ 1:** Метод Гаусса (приведение к ступенчатому виду)
2. **Способ 2:** Вычислить определитель

Если определитель ≠ 0, то ранг = размеру матрицы (полный ранг).

---

## Вычисление определителя матрицы 3×3

Формула для определителя 3×3:

```
det(R) = a₁₁(a₂₂a₃₃ - a₂₃a₃₂) - a₁₂(a₂₁a₃₃ - a₂₃a₃₁) + a₁₃(a₂₁a₃₂ - a₂₂a₃₁)
```

Где наша матрица:
```
R = [  1.000   0.816   0.000  ]
    [  0.816   1.000   0.290  ]
    [  0.000   0.290   1.000  ]
```

---

### Подставляем значения:

```
a₁₁ = 1.000,  a₁₂ = 0.816,  a₁₃ = 0.000
a₂₁ = 0.816,  a₂₂ = 1.000,  a₂₃ = 0.290
a₃₁ = 0.000,  a₃₂ = 0.290,  a₃₃ = 1.000
```

---

### Вычисляем по частям:

**Часть 1:** a₁₁(a₂₂a₃₃ - a₂₃a₃₂)
```
= 1.000 × (1.000 × 1.000 - 0.290 × 0.290)
= 1.000 × (1.000 - 0.0841)
= 1.000 × 0.9159
= 0.9159
```

---

**Часть 2:** a₁₂(a₂₁a₃₃ - a₂₃a₃₁)
```
= 0.816 × (0.816 × 1.000 - 0.290 × 0.000)
= 0.816 × (0.816 - 0)
= 0.816 × 0.816
= 0.6659
```

---

**Часть 3:** a₁₃(a₂₁a₃₂ - a₂₂a₃₁)
```
= 0.000 × (0.816 × 0.290 - 1.000 × 0.000)
= 0.000 × (0.2366 - 0)
= 0
```

---

### Итоговый определитель:

```
det(R) = 0.9159 - 0.6659 + 0
       = 0.2500
       ≈ 0.25
```

### **det(R) ≈ 0.25 ≠ 0**

---

## Что это означает?

Поскольку **det(R) ≠ 0**, матрица **невырожденная** (обратимая).

**Ранг матрицы R = 3** (полный ранг)

Это значит, что все 3 признака **линейно независимы** — ни один не может быть выражен через другие!

---

# Выводы по Заданию 3:

### 1. **Корреляционная матрица:**

```
              Комнаты  Площадь  Этаж
Комнаты    [   1.000    0.816   0.000  ]
Площадь    [   0.816    1.000   0.290  ]
Этаж       [   0.000    0.290   1.000  ]
```

---

### 2. **Сильная связь:** "Комнаты" ↔ "Площадь" (r = 0.816)
- Это логично: больше комнат → больше площадь
- **Риск мультиколлинеарности** средний
- В модели можно оставить оба признака, но они частично дублируют информацию

---

### 3. **Нулевая связь:** "Комнаты" ↔ "Этаж" (r = 0.000)
- Полная независимость! 
- Количество комнат **не зависит** от этажа
- Отлично для модели — признаки дополняют друг друга

---

### 4. **Слабая связь:** "Площадь" ↔ "Этаж" (r = 0.290)
- Очень слабая положительная связь
- Практически независимы
- Хорошо для модели

---

### 5. **Ранг матрицы = 3 (полный ранг)**
- **Определитель det(R) = 0.25 ≠ 0**
- Все признаки **линейно независимы**
- Ни один признак не является комбинацией других
- **Мультиколлинеарности НЕТ!**

---

### 6. **Практические выводы:**

**Можно безопасно использовать все 3 признака** в модели

**Матрица обратима** → можно вычислить коэффициенты регрессии по формуле β = (X^T X)^(-1) X^T Y

**Есть умеренная корреляция** между "Комнаты" и "Площадь" (0.816), но это не критично

---

### 7. **Что было бы плохо?**

Если бы det(R) ≈ 0 → **мультиколлинеарность**
- Пример: если "Площадь" всегда = 15 × "Комнаты"
- Тогда признаки дублируют информацию
- Модель становится нестабильной

Если бы r(Комнаты, Площадь) > 0.95 → **сильная мультиколлинеарность**
- Нужно было бы удалить один из признаков
- Или создать новый комбинированный признак

---

### 8. **Почему важен порядок вычислений?**

В задании сказано, что при **больших матрицах** порядок группировки влияет на эффективность:

- Если ранг < число признаков → некоторые признаки **линейно зависимы**
- Это создаёт проблемы при вычислении обратной матрицы
- В таком случае модель может дать **очень большие коэффициенты** (признак неустойчивости)

---
Отлично! Продолжаем с **Заданием 4**.

---

# Задание 4. Обратная матрица

## Цель задания

Чтобы **аналитически найти коэффициенты регрессии**, нужно вычислить формулу:

```
β̂ = (X^T X)^(-1) X^T Y
```

Ключевой элемент здесь — **обратная матрица** (X^T X)^(-1).

**Обратная матрица** существует только если:
1. Матрица **квадратная**
2. **Определитель ≠ 0** (матрица невырожденная)

---

## Шаг 1: Формируем небольшую матрицу признаков X

По заданию:
- Берём **3 квартиры** (первые 3)
- Берём **2 признака**: "Комнаты" и "Площадь"

```
       Комнаты  Площадь
X = [     3       51     ]  ← квартира 1
    [     1       30     ]  ← квартира 2
    [     2       45     ]  ← квартира 3
```

**Размерность X: 3×2** (3 квартиры, 2 признака)

---

## Шаг 2: Вычисляем матрицу A = X^T X

### Транспонируем X:

```
X^T = [  3    1    2  ]  ← признак "Комнаты"
      [ 51   30   45  ]  ← признак "Площадь"
```

**Размерность X^T: 2×3**

---

### Вычисляем A = X^T × X

**X^T**: 2×3
**X**: 3×2
**Результат A**: 2×2 (квадратная!)

---

### Элемент A(1,1): первая строка X^T × первый столбец X

```
X^T строка 1: [3, 1, 2]
X столбец 1:  [3, 1, 2] (это "Комнаты")

A(1,1) = 3×3 + 1×1 + 2×2
       = 9 + 1 + 4
       = 14
```

---

### Элемент A(1,2): первая строка X^T × второй столбец X

```
X^T строка 1: [3, 1, 2]
X столбец 2:  [51, 30, 45] (это "Площадь")

A(1,2) = 3×51 + 1×30 + 2×45
       = 153 + 30 + 90
       = 273
```

---

### Элемент A(2,1): вторая строка X^T × первый столбец X

```
X^T строка 2: [51, 30, 45]
X столбец 1:  [3, 1, 2]

A(2,1) = 51×3 + 30×1 + 45×2
       = 153 + 30 + 90
       = 273
```

---

### Элемент A(2,2): вторая строка X^T × второй столбец X

```
X^T строка 2: [51, 30, 45]
X столбец 2:  [51, 30, 45]

A(2,2) = 51×51 + 30×30 + 45×45
       = 2601 + 900 + 2025
       = 5526
```

---

### Итоговая матрица A = X^T X:

```
A = [  14   273  ]
    [ 273  5526  ]
```

**Размерность: 2×2** (квадратная матрица!)

---

## Шаг 3: Вычисляем определитель det(A)

Для матрицы 2×2:

```
A = [ a  b ]
    [ c  d ]

det(A) = a×d - b×c
```

В нашем случае:

```
a = 14,  b = 273
c = 273, d = 5526
```

---

### Вычисление:

```
det(A) = 14 × 5526 - 273 × 273
       = 77364 - 74529
       = 2835
```

### **det(A) = 2835 ≠ 0**

**Вывод:** Матрица **невырожденная**, обратная матрица существует!

---

## Что означает det(A) = 0?

Если бы det(A) = 0, это означало бы:
- Признаки **линейно зависимы**
- Один признак — комбинация другого
- **Нельзя найти коэффициенты регрессии** обычным способом
- Модель переполнена или содержит дублирующую информацию

**Пример:** Если "Площадь" всегда = 15.5 × "Комнаты", то:
- det(A) = 0
- Признаки дублируют информацию
- Нужно удалить один из них

В нашем случае det(A) = 2835 >> 0, значит признаки **независимы**!

---

## Шаг 4: Если det(A) = 0 и если det(A) ≠ 0

---

### Случай 1: det(A) = 0 (вырожденная матрица)

**Что это означает:**
1. Столбцы матрицы X **линейно зависимы**
2. Один или несколько признаков — **комбинация других**
3. Матрица X^T X **не имеет обратной** (ранг < n)

**Почему нельзя найти коэффициенты:**
- Формула требует (X^T X)^(-1)
- Обратная матрица существует **только если det ≠ 0**
- При det = 0 система уравнений имеет **бесконечно много решений** или не имеет решения

**Пример:**
```
Если Площадь = 15 × Комнаты везде:
X = [ 3  45  ]
    [ 1  15  ]
    [ 2  30  ]

X^T X = [ 14  210 ]
        [ 210 3150]

det = 14×3150 - 210×210 = 44100 - 44100 = 0
```

---

### Случай 2: det(A) ≠ 0 (невырожденная матрица)

**Что это означает:**
1. Столбцы матрицы X **линейно независимы**
2. Каждый признак несёт **уникальную информацию**
3. Матрица X^T X **обратима**

**Можно найти коэффициенты:**
- Формула β̂ = (X^T X)^(-1) X^T Y **работает**
- Решение **единственное**
- Модель **устойчива**

У нас det(A) = 2835 ≠ 0, поэтому всё хорошо!

---

## Шаг 5: Если det(A) ≠ 0, найдите обратную матрицу A^(-1)

По заданию написано: *"Если det(A) ≠ 0: найдите обратную матрицу A^(-1) вручную, используя формулу для матрицы 2×2."*

### Формула обратной матрицы 2×2:

Для матрицы:
```
A = [ a  b ]
    [ c  d ]
```

Обратная матрица:
```
A^(-1) = (1 / det(A)) × [  d  -b ]
                        [ -c   a ]
```

---

### Применяем к нашей матрице:

```
A = [  14   273  ]
    [ 273  5526  ]

det(A) = 2835
```

---

### Шаг 5.1: Меняем элементы по формуле

```
[  d  -b ] = [ 5526  -273 ]
[ -c   a ]   [ -273   14  ]
```

---

### Шаг 5.2: Умножаем на 1/det(A)

```
A^(-1) = (1/2835) × [ 5526  -273 ]
                     [ -273   14  ]
```

---

### Шаг 5.3: Вычисляем каждый элемент

**Элемент (1,1):**
```
A^(-1)(1,1) = 5526 / 2835
            = 1.9494...
            ≈ 1.949
```

---

**Элемент (1,2):**
```
A^(-1)(1,2) = -273 / 2835
            = -0.0963...
            ≈ -0.096
```

---

**Элемент (2,1):**
```
A^(-1)(2,1) = -273 / 2835
            = -0.0963...
            ≈ -0.096
```

---

**Элемент (2,2):**
```
A^(-1)(2,2) = 14 / 2835
            = 0.00494...
            ≈ 0.00494
```

---

### Итоговая обратная матрица A^(-1):

```
A^(-1) = [  1.949    -0.096  ]
         [ -0.096     0.00494]
```

**Размерность: 2×2**

---

## Проверка: A × A^(-1) = I (единичная матрица)

Давайте проверим, что наша обратная матрица вычислена правильно!

**Должно получиться:**
```
I = [ 1  0 ]
    [ 0  1 ]
```

---

### Элемент (1,1): первая строка A × первый столбец A^(-1)

```
A строка 1: [14, 273]
A^(-1) столбец 1: [1.949, -0.096]

(1,1) = 14 × 1.949 + 273 × (-0.096)
      = 27.286 + (-26.208)
      = 1.078
      ≈ 1
```

(Небольшая погрешность из-за округления)

---

### Элемент (1,2): первая строка A × второй столбец A^(-1)

```
A строка 1: [14, 273]
A^(-1) столбец 2: [-0.096, 0.00494]

(1,2) = 14 × (-0.096) + 273 × 0.00494
      = -1.344 + 1.349
      = 0.005
      ≈ 0
```

---

### Элемент (2,1): вторая строка A × первый столбец A^(-1)

```
A строка 2: [273, 5526]
A^(-1) столбец 1: [1.949, -0.096]

(2,1) = 273 × 1.949 + 5526 × (-0.096)
      = 532.077 + (-530.496)
      = 1.581
      ≈ 0
```

(Должно быть 0, но есть погрешность из-за округления)

---

### Элемент (2,2): вторая строка A × второй столбец A^(-1)

```
A строка 2: [273, 5526]
A^(-1) столбец 2: [-0.096, 0.00494]

(2,2) = 273 × (-0.096) + 5526 × 0.00494
      = -26.208 + 27.298
      = 1.090
      ≈ 1
```

---

### Результат проверки:

```
A × A^(-1) ≈ [ 1.078   0.005 ]
             [ 1.581   1.090 ]
```

Не идеально единичная из-за округлений, но **достаточно близко**!

Для точного результата используем больше знаков после запятой:

```
A^(-1) = [ 5526/2835   -273/2835 ]
         [ -273/2835     14/2835  ]
```

В дробях (точное значение):

```
A^(-1) = [ 1842/945   -91/945  ]
         [ -91/945     14/2835 ]
```

---

## Выводы по Заданию 4:

### 1. **Матрица A = X^T X:**

```
A = [  14   273  ]
    [ 273  5526  ]
```

Эта матрица **квадратная 2×2** и **симметричная**.

---

### 2. **Определитель det(A) = 2835 ≠ 0**

Матрица **невырожденная**
Обратная матрица **существует**
Признаки "Комнаты" и "Площадь" **линейно независимы**
Можно найти коэффициенты регрессии

---

### 3. **Обратная матрица A^(-1):**

```
A^(-1) = [  1.949    -0.096  ]
         [ -0.096     0.00494]
```

Или в точном виде:

```
A^(-1) = (1/2835) × [ 5526  -273 ]
                     [ -273   14  ]
```

---

### 4. **Что означает det(A) = 0?**

Если бы det(A) = 0:
- Признаки **линейно зависимы**
- Один признак — **линейная комбинация другого**
- Обратной матрицы **не существует**
- **Нельзя найти коэффициенты** по формуле β̂ = (X^T X)^(-1) X^T Y
- Модель **переопределена** (мультиколлинеарность)

**Решение:** удалить один из зависимых признаков

---

### 5. **Почему в нашем случае всё хорошо?**

det(A) = 2835 >> 0 означает:
- "Комнаты" и "Площадь" **не дублируют** информацию
- Хотя они коррелируют (r = 0.816), это **не критично**
- Каждый признак вносит **уникальный вклад** в предсказание цены
- Модель будет **устойчивой**

---

### 6. **Интерпретация элементов A^(-1):**

```
A^(-1) = [  1.949    -0.096  ]
         [ -0.096     0.00494]
```

- **Диагональные элементы** (1.949, 0.00494) — обратные величины "силы" признаков
- **Недиагональные элементы** (-0.096) — коррекция из-за корреляции между признаками
- Отрицательные значения показывают, что при увеличении одного признака нужно немного уменьшить влияние другого

---

